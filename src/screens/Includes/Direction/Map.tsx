import { btnPrimary } from "@constants/Colors";
import {
  default as Vietmap,
  default as VietmapGL,
} from "@vietmap/vietmap-gl-react-native";
import MapIcon from "assets/svg/MapIcon";
import React, { useRef, useState } from "react";
export default function Map() {
  const mapRef = useRef<any>(null);

  const [markerCoordinates, setMarkerCoordinates] = useState(null);
  const [selectedFeatures, setSelectedFeatures] = useState([]);
  const handleMapClick = async (feature: any) => {
    // Handle the map click event
    if (mapRef.current) {
      console.log(feature);
      const { geometry, properties } = feature;

      setMarkerCoordinates(geometry.coordinates);
      console.log("Clicked at coordinates:", geometry.coordinates);
      console.log("Feature properties:", properties);

      /// Query data from rendered map, like point, admin,...
      const selectedFeatures =
        await mapRef.current.queryRenderedFeaturesAtPoint(
          [properties.screenPointX, properties.screenPointX],
          null
        );

      console.log("Rendered Features:", selectedFeatures);
      setSelectedFeatures(selectedFeatures);
    } else {
      console.error("Feature failed");
    }
  };
  const centerCoordinates = [106.800106, 10.704619];
  const lineCoordinates = [
    [106.62968, 10.82308],
    [106.6296, 10.82319],
    [106.6295, 10.82311],
    [106.62987, 10.82261],
    [106.62996, 10.82245],
    [106.63005, 10.82223],
    [106.6302, 10.82182],
    [106.63061, 10.82041],
    [106.63063, 10.82034],
    [106.63232, 10.8149],
    [106.63268, 10.81372],
    [106.633, 10.81269],
    [106.63394, 10.80948],
    [106.63438, 10.80799],
    [106.63482, 10.80736],
    [106.63505, 10.80714],
    [106.63538, 10.80682],
    [106.63609, 10.80617],
    [106.63626, 10.80599],
    [106.63637, 10.80587],
    [106.63669, 10.8054],
    [106.63754, 10.80419],
    [106.63803, 10.80349],
    [106.63815, 10.80332],
    [106.63822, 10.80324],
    [106.63834, 10.80314],
    [106.63867, 10.8029],
    [106.63876, 10.80286],
    [106.63895, 10.80278],
    [106.63928, 10.80265],
    [106.63963, 10.80256],
    [106.6399, 10.80251],
    [106.64041, 10.80247],
    [106.64162, 10.80237],
    [106.64346, 10.80222],
    [106.64388, 10.80218],
    [106.64506, 10.80208],
    [106.64534, 10.80206],
    [106.64538, 10.80208],
    [106.64557, 10.80209],
    [106.64561, 10.8021],
    [106.64751, 10.80192],
    [106.64947, 10.80177],
    [106.64984, 10.80171],
    [106.6499, 10.80167],
    [106.65115, 10.80156],
    [106.65263, 10.80143],
    [106.65336, 10.80136],
    [106.6538, 10.80133],
    [106.65393, 10.80131],
    [106.65427, 10.80128],
    [106.65471, 10.80124],
    [106.65496, 10.80122],
    [106.65565, 10.80116],
    [106.65643, 10.80109],
    [106.65684, 10.80105],
    [106.65725, 10.80102],
    [106.65754, 10.801],
    [106.65784, 10.80097],
    [106.65857, 10.80092],
    [106.65867, 10.80096],
    [106.66052, 10.8008],
    [106.66116, 10.80073],
    [106.66164, 10.80071],
    [106.66236, 10.80069],
    [106.66315, 10.80064],
    [106.66377, 10.80058],
    [106.6655, 10.80041],
    [106.66684, 10.80029],
    [106.66701, 10.80023],
    [106.66761, 10.80011],
    [106.66793, 10.79998],
    [106.66842, 10.79972],
    [106.66916, 10.79931],
    [106.66986, 10.79888],
    [106.67025, 10.79865],
    [106.67106, 10.79818],
    [106.67142, 10.79797],
    [106.67165, 10.79783],
    [106.67267, 10.79723],
    [106.6729, 10.7971],
    [106.67327, 10.79687],
    [106.67368, 10.79663],
    [106.67383, 10.79654],
    [106.67437, 10.79623],
    [106.67442, 10.79619],
    [106.67447, 10.79617],
    [106.67497, 10.79587],
    [106.67547, 10.79557],
    [106.67597, 10.79529],
    [106.6763, 10.79509],
    [106.6767, 10.79486],
    [106.67705, 10.79465],
    [106.6779, 10.79415],
    [106.6782, 10.79397],
    [106.67841, 10.79385],
    [106.67861, 10.79373],
    [106.67903, 10.79349],
    [106.6792, 10.79339],
    [106.68002, 10.79289],
    [106.6804, 10.79268],
    [106.68122, 10.79218],
    [106.68195, 10.79152],
    [106.68264, 10.79089],
    [106.6828, 10.79074],
    [106.68318, 10.79039],
    [106.68351, 10.79008],
    [106.68357, 10.79003],
    [106.68364, 10.78996],
    [106.68393, 10.7897],
    [106.68413, 10.78951],
    [106.68429, 10.78936],
    [106.68476, 10.78893],
    [106.68524, 10.78848],
    [106.68542, 10.78831],
    [106.68606, 10.78773],
    [106.68633, 10.78748],
    [106.68726, 10.78661],
    [106.68762, 10.78628],
    [106.68886, 10.78514],
    [106.68907, 10.78495],
    [106.68992, 10.78419],
    [106.69074, 10.78342],
    [106.69111, 10.78309],
    [106.69127, 10.78296],
    [106.69161, 10.78266],
    [106.69182, 10.78247],
    [106.69244, 10.78193],
    [106.69277, 10.78163],
    [106.69296, 10.78146],
    [106.69399, 10.78052],
    [106.69498, 10.77962],
    [106.69532, 10.78],
    [106.69577, 10.78044],
    [106.69582, 10.78049],
    [106.69587, 10.78054],
    [106.69692, 10.78166],
    [106.69733, 10.78212],
    [106.69808, 10.78291],
    [106.69891, 10.78212],
    [106.69961, 10.78154],
    [106.69979, 10.78173],
    [106.70004, 10.782],
    [106.70022, 10.7822],
    [106.70039, 10.78239],
    [106.70076, 10.78279],
    [106.70115, 10.78319],
    [106.70179, 10.78385],
    [106.70254, 10.78465],
    [106.70306, 10.7852],
    [106.70365, 10.78465],
    [106.70397, 10.78437],
    [106.70419, 10.78417],
    [106.70455, 10.78384],
    [106.70648, 10.78202],
    [106.70754, 10.78107],
    [106.70785, 10.78082],
    [106.70803, 10.78069],
    [106.70856, 10.78041],
    [106.71088, 10.77911],
    [106.7126, 10.77813],
    [106.71316, 10.77784],
    [106.714, 10.77739],
    [106.71411, 10.77734],
    [106.71419, 10.77729],
    [106.71427, 10.77725],
    [106.71523, 10.77672],
    [106.71605, 10.77626],
    [106.71699, 10.77575],
    [106.7169, 10.77556],
    [106.71679, 10.77534],
    [106.71671, 10.77514],
    [106.71658, 10.77468],
    [106.71651, 10.77436],
    [106.71646, 10.77409],
    [106.71643, 10.77375],
    [106.71642, 10.77332],
    [106.71645, 10.77298],
    [106.7165, 10.77261],
    [106.71663, 10.77209],
    [106.71683, 10.77152],
    [106.71687, 10.77137],
    [106.71692, 10.77116],
    [106.71857, 10.77159],
    [106.72001, 10.77205],
    [106.72108, 10.77245],
    [106.72212, 10.7729],
    [106.72249, 10.77306],
    [106.72272, 10.77318],
    [106.72284, 10.77324],
    [106.72311, 10.77337],
    [106.72423, 10.77393],
    [106.72504, 10.77435],
    [106.72681, 10.77526],
    [106.7273, 10.77551],
    [106.72752, 10.77562],
    [106.72778, 10.77576],
    [106.72796, 10.77585],
    [106.73236, 10.77811],
    [106.7347, 10.77931],
    [106.73776, 10.78088],
    [106.73882, 10.78142],
    [106.73931, 10.78168],
    [106.73956, 10.78181],
    [106.73991, 10.78199],
    [106.74029, 10.78218],
    [106.74317, 10.78366],
    [106.74873, 10.78653],
    [106.74925, 10.78689],
    [106.7495, 10.78709],
    [106.74984, 10.7874],
    [106.75001, 10.78756],
    [106.75034, 10.78792],
    [106.75068, 10.78839],
    [106.75095, 10.78886],
    [106.75111, 10.78918],
    [106.75127, 10.78959],
    [106.75134, 10.78987],
    [106.75143, 10.79018],
    [106.75175, 10.79183],
    [106.75182, 10.79212],
    [106.75188, 10.79245],
    [106.75202, 10.79248],
    [106.75258, 10.79252],
    [106.75386, 10.79266],
    [106.7544, 10.79287],
  ];
  return (
    <VietmapGL.MapView
      ref={mapRef}
      styleURL={
        "https://maps.vietmap.vn/api/maps/dark/styles.json?apikey=9cbf0bc15d3901b7e043d8f76be8d73f370a82fe629a2d46"
      }
      style={{ flex: 1 }}
      logoEnabled={false}
      onPress={handleMapClick}
    >
      <VietmapGL.Camera
        zoomLevel={13}
        followZoomLevel={13}
        followUserLocation={false}
        centerCoordinate={centerCoordinates}
      />

      <VietmapGL.ShapeSource
        id="lineSource"
        shape={{ type: "LineString", coordinates: lineCoordinates }}
      >
        <VietmapGL.LineLayer
          id="lineLayer"
          style={{
            lineColor: btnPrimary,
            lineWidth: 6,
            lineJoin: "round",
            lineCap: "round",
          }}
        />
      </VietmapGL.ShapeSource>
      <Vietmap.MarkerView coordinate={[106.800106, 10.704619]}>
        <Vietmap.Callout title={"this is a marker view"} />
      </Vietmap.MarkerView>
      <Vietmap.PointAnnotation
        id="annotation-hidden"
        coordinate={[106.880106, 10.604619]}
        style={{ backgroundColor: "white" }}
      >
        <MapIcon />
      </Vietmap.PointAnnotation>
    </VietmapGL.MapView>
  );
}

const coordQuads = [
  [
    [106.492888, 10.957413], // top left
    [106.9271, 10.951878], // top right
    [106.958675, 10.653745], // bottom right
    [106.44408, 10.654078], // bottom left
  ],
  [
    [106.512888, 10.977413], // top left
    [106.9471, 10.971878], // top right
    [106.978675, 10.673745], // bottom right
    [106.46408, 10.674078], // bottom left
  ],
];
const styles = {
  rasterLayer: { rasterOpacity: 0.6 },
  bubble: { bottom: 100 },
};
